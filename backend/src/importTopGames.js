import axios from "axios";
import dotenv from "dotenv";

dotenv.config();

// üöÄ URL de tu backend (puede ser Render o localhost)
const API_URL = process.env.API_URL || "http://localhost:4000/api/games";

// üéÆ Lista de 200 juegos populares y activos
const appIds = [
  // Top shooters / multijugadores
  "730","570","578080","1172470","252490","381210","440","271590","1091500",
  "1506830","1085660","394360","582660","431960","620980","1245620","1938090",
  "1240440","1222730","252950","242760","275850","221100","8930","255710",
  "359550","311210","1623730","105600","294100","227300","814380","239140",
  "632360","219740","367520","289070","12210","50130","582010","1623660",
  "292120","1446780","1583720","22380","203160","346110","552500","1172380",
  "774171","1604030","49520","379720","1248130","200510","211820","4000",
  "644930","227940","271590","108600","632470","1625450","1091500","582660",
  "427520","1172380","444090","1144200","1127400","513710","1248130","271590",
  "812140","1604030","232090","262060","292120","548430","47890","221100",
  "239140","1174180","1100600","582010","20570","381210","552500","239140",
  // Nuevos a√±adidos (actuales, 2024‚Äì2025)
  "440900","1281930","739630","1593500","582010","578080","236390","1245620",
  "1574580","1286680","1966720","2221490","1091500","1222670","291550","291480",
  "1172470","1328670","264710","1604030","1172620","1404210","1057090","552500",
  "346110","1144200","526870","1097150","1121560","1097830","1203220","782330",
  "550","220","620","4000","500","420","440","570","730","945360","1174180",
  "1190460","1446780","1086940","1085660","1272080","108600","1527950","1583720",
  "105600","322330","252490","1203220","1874880","1677740","255710","1609130",
  "1665460","271590","20570","1328670","107410","346110","1172470","1938090",
  "238960","291550","379720","814380","582010","739630","1203220","1248130",
  "1172380","252490","440900","4000","220","550","500","620","440","1091500"
];

// ‚öôÔ∏è Importa juegos por lotes (seguro para Render)
async function importGames() {
  const batchSize = 5;
  let imported = 0;

  for (let i = 0; i < appIds.length; i += batchSize) {
    const batch = appIds.slice(i, i + batchSize);
    console.log(`üì¶ Importando lote ${i / batchSize + 1}...`);

    try {
      await Promise.allSettled(
        batch.map((id) =>
          axios.get(`${API_URL}/import/${id}`).then((r) => {
            console.log(`‚úÖ ${r.data.name} (${id})`);
          })
        )
      );
    } catch (err) {
      console.error("‚ùå Error en lote:", err.message);
    }

    imported += batch.length;
    console.log(`Progreso: ${imported}/${appIds.length}`);

    // üïí Espera entre lotes (Render Free friendly)
    await new Promise((res) => setTimeout(res, 1500));
  }

  console.log("üéâ Importaci√≥n completada correctamente");
}

importGames();
